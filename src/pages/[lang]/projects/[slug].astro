---

import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const projects = await getCollection('projects');

  return projects.map((project) => ({
    params: {
      lang: project.data.locale,
      slug: project.slug,
    },
  }));
}

const { params } = Astro;
const { lang, slug } = params;

const allProjects = await getCollection('projects');
const project = allProjects.find(
  (p) => p.slug === slug && p.data.locale === lang
);

if (!project) {
  throw new Error(`Project "${slug}" not found for locale "${lang}".`);
}

const { title, description, image, github, stack, tag, translationOf } = project.data;

const otherLang = lang === 'fr' ? 'en' : 'fr';
const altVersion = allProjects.find(
  (p) => p.data.translationOf === translationOf && p.data.locale === otherLang
);
---





<BaseLayout>
  <section class="max-w-3xl mx-auto py-12">
    <h1 class="text-4xl font-bold text-charcoal mb-6">{title}</h1>
    {description && <p class="text-gray-600 mb-6">{description}</p>}

    {image && <img src={image} alt={title} class="mb-6 rounded shadow" />}

    {stack && (
      <ul class="flex flex-wrap gap-2 text-sm text-white mb-6">
        {stack.map((tech) => (
          <li class="bg-charcoal px-3 py-1 rounded">{tech}</li>
        ))}
      </ul>
    )}

    <article class="prose max-w-none">
      {project.body}
    </article>

    {github && (
      <p class="mt-8">
        <a
          href={github}
          target="_blank"
          rel="noopener"
          class="text-gold hover:underline"
        >
          GitHub â†—
        </a>
      </p>
    )}
  </section>
</BaseLayout>
