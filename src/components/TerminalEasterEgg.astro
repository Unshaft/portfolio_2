---
// Terminal Easter Egg - activated by pressing ` (backtick) key
// A fun interactive terminal overlay with custom commands
---

<div
  id="terminal-overlay"
  class="fixed inset-0 z-[9999] bg-black/95 backdrop-blur-md hidden items-center justify-center p-4 sm:p-8"
  style="font-family: 'JetBrains Mono', 'Fira Code', monospace;"
  role="dialog"
  aria-modal="true"
  aria-label="Terminal interactif"
>
  <div class="w-full max-w-2xl bg-gray-950 rounded-xl border border-gold/30 shadow-2xl shadow-gold/10 overflow-hidden">
    <!-- Terminal header -->
    <div class="flex items-center gap-2 px-4 py-3 bg-gray-900 border-b border-gray-800">
      <div class="w-3 h-3 rounded-full bg-red-500"></div>
      <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
      <div class="w-3 h-3 rounded-full bg-green-500"></div>
      <span class="ml-3 text-xs text-gray-500">killian@portfolio ~ </span>
      <button id="terminal-close" class="ml-auto text-gray-500 hover:text-white transition-colors text-xs cursor-pointer">[ESC] close</button>
    </div>

    <!-- Terminal body -->
    <div id="terminal-body" class="p-4 h-80 sm:h-96 overflow-y-auto text-sm leading-relaxed">
      <div id="terminal-output" class="text-green-400 space-y-1"></div>
      <div class="flex items-center gap-2 mt-2">
        <span class="text-gold font-bold">$</span>
        <input
          id="terminal-input"
          type="text"
          class="bg-transparent border-none outline-none text-green-300 flex-1 caret-gold"
          autocomplete="off"
          spellcheck="false"
          placeholder="type 'help' to get started..."
        />
      </div>
    </div>
  </div>
</div>

<script>
  const overlay = document.getElementById('terminal-overlay') as HTMLDivElement;
  const input = document.getElementById('terminal-input') as HTMLInputElement;
  const output = document.getElementById('terminal-output') as HTMLDivElement;
  const body = document.getElementById('terminal-body') as HTMLDivElement;
  const closeBtn = document.getElementById('terminal-close') as HTMLButtonElement;

  if (overlay && input && output && body && closeBtn) {
    let isOpen = false;

    const COMMANDS: Record<string, () => string[]> = {
      help: () => [
        '<span class="text-gold font-bold">Available commands:</span>',
        '',
        '  <span class="text-cyan-400">about</span>      â€” Who is Killian?',
        '  <span class="text-cyan-400">skills</span>     â€” Tech stack',
        '  <span class="text-cyan-400">contact</span>    â€” Get in touch',
        '  <span class="text-cyan-400">projects</span>   â€” Featured projects',
        '  <span class="text-cyan-400">hire</span>       â€” Why hire me?',
        '  <span class="text-cyan-400">coffee</span>     â€” Essential fuel',
        '  <span class="text-cyan-400">sudo</span>       â€” Try it...',
        '  <span class="text-cyan-400">matrix</span>     â€” Enter the matrix',
        '  <span class="text-cyan-400">clear</span>      â€” Clear terminal',
        '  <span class="text-cyan-400">exit</span>       â€” Close terminal',
      ],
      about: () => [
        '<span class="text-gold">Killian Perzo</span>',
        'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
        'Data Scientist specialized in <span class="text-cyan-400">Agentic AI</span>',
        'Building autonomous agents & multi-agent systems',
        'Currently @ <span class="text-gold">Median Technologies</span>',
        'MSc in Data Analytics @ DSTI',
        '',
        '<span class="text-gray-500">// Turning data into intelligent decisions</span>',
      ],
      skills: () => [
        '<span class="text-gold">Tech Stack</span>',
        'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
        '  <span class="text-cyan-400">Languages</span>    Python, TypeScript, SQL',
        '  <span class="text-cyan-400">AI/ML</span>        LangChain, LangGraph, Claude AI, scikit-learn',
        '  <span class="text-cyan-400">APIs</span>         FastAPI, REST, OAuth',
        '  <span class="text-cyan-400">Databases</span>    ChromaDB, MongoDB, PostgreSQL',
        '  <span class="text-cyan-400">Tools</span>        Docker, Git, Streamlit, Power BI',
        '  <span class="text-cyan-400">Frontend</span>     Astro, React, Tailwind CSS',
      ],
      contact: () => [
        '<span class="text-gold">Get in touch</span>',
        'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
        '  ğŸ“§  killian.perzo@gmail.com',
        '  ğŸ”—  github.com/Unshaft',
        '  ğŸ’¼  linkedin.com/in/killianperzo',
        '',
        '<span class="text-gray-500">// Always open to interesting projects</span>',
      ],
      projects: () => [
        '<span class="text-gold">Featured Projects</span>',
        'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
        '  <span class="text-green-400">[01]</span> DataSentinel AI â€” Intelligent monitoring with autonomous agents',
        '  <span class="text-green-400">[02]</span> Data Quality Agent â€” Automated quality analysis via LangGraph',
        '  <span class="text-green-400">[03]</span> Wedding Website â€” Full-stack Next.js 15 with admin panel',
        '  <span class="text-green-400">[04]</span> QueryBot API â€” Automated JIRA ticket creation',
        '  <span class="text-green-400">[05]</span> Budget Tracker â€” Data viz with Streamlit & Plotly',
        '  <span class="text-green-400">[06]</span> Badminton ML â€” Pose analysis with MediaPipe',
      ],
      hire: () => [
        '<span class="text-gold">Why hire Killian?</span>',
        'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
        '  âœ“ Builds <span class="text-cyan-400">production-ready</span> autonomous AI agents',
        '  âœ“ End-to-end: from data pipelines to deployed APIs',
        '  âœ“ Multi-agent systems that actually work in prod',
        '  âœ“ Strong data analysis & visualization background',
        '  âœ“ Bilingual FR/EN, team player, fast learner',
        '',
        '<span class="text-green-400">Status: Open to opportunities ğŸš€</span>',
      ],
      coffee: () => [
        '',
        '    ( (   ',
        '     ) )  ',
        '  ........',
        '  |      |]',
        '  \\      / ',
        '   `----Â´  ',
        '',
        '<span class="text-gold">Coffee is the fuel of innovation.</span>',
        '<span class="text-gray-500">// Current count today: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%</span>',
      ],
      sudo: () => [
        '<span class="text-red-400">Permission denied.</span>',
        '<span class="text-gray-500">Nice try. But this is a portfolio, not a server ğŸ˜‰</span>',
      ],
      matrix: () => {
        setTimeout(() => {
          if (output) {
            let matrixLines = '';
            for (let i = 0; i < 8; i++) {
              let line = '';
              for (let j = 0; j < 50; j++) {
                line += String.fromCharCode(0x30A0 + Math.random() * 96);
              }
              matrixLines += `<div class="text-green-500 opacity-${50 + i * 7}">${line}</div>`;
            }
            const el = document.createElement('div');
            el.innerHTML = matrixLines;
            output.appendChild(el);
            body.scrollTop = body.scrollHeight;
          }
        }, 300);
        return [
          '<span class="text-green-500">Wake up, Neo...</span>',
          '<span class="text-green-500">The Matrix has you...</span>',
        ];
      },
      clear: () => {
        if (output) output.innerHTML = '';
        return [];
      },
      exit: () => {
        setTimeout(() => {
          if (overlay) {
            overlay.classList.add('hidden');
            overlay.classList.remove('flex');
            isOpen = false;
          }
        }, 100);
        return ['<span class="text-gray-500">Goodbye! Press ` to come back.</span>'];
      },
    };

    function addOutput(lines: string[]) {
      lines.forEach((line) => {
        const div = document.createElement('div');
        div.innerHTML = line || '&nbsp;';
        output.appendChild(div);
      });
      body.scrollTop = body.scrollHeight;
    }

    function processCommand(cmd: string) {
      const trimmed = cmd.trim().toLowerCase();
      const cmdDiv = document.createElement('div');
      cmdDiv.innerHTML = `<span class="text-gold">$</span> <span class="text-white">${cmd}</span>`;
      output.appendChild(cmdDiv);

      if (trimmed === '') {
        body.scrollTop = body.scrollHeight;
        return;
      }

      const handler = COMMANDS[trimmed];
      if (handler) {
        addOutput(handler());
      } else {
        addOutput([
          `<span class="text-red-400">Command not found: ${trimmed}</span>`,
          '<span class="text-gray-500">Type \'help\' for available commands.</span>',
        ]);
      }
    }

    // Open terminal on backtick
    document.addEventListener('keydown', (e) => {
      if (e.key === '`' && !isOpen) {
        e.preventDefault();
        overlay.classList.remove('hidden');
        overlay.classList.add('flex');
        isOpen = true;
        input.focus();
        if (output.children.length === 0) {
          addOutput([
            '<span class="text-gold font-bold">â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—</span>',
            '<span class="text-gold font-bold">â•‘   Killian Perzo â€” Terminal v1.0      â•‘</span>',
            '<span class="text-gold font-bold">â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>',
            '',
            'Welcome! Type <span class="text-cyan-400">help</span> to see available commands.',
            '',
          ]);
        }
      }

      if (e.key === 'Escape' && isOpen) {
        overlay.classList.add('hidden');
        overlay.classList.remove('flex');
        isOpen = false;
      }
    });

    closeBtn.addEventListener('click', () => {
      overlay.classList.add('hidden');
      overlay.classList.remove('flex');
      isOpen = false;
    });

    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        processCommand(input.value);
        input.value = '';
      }
    });

    // Click outside to close
    overlay.addEventListener('click', (e) => {
      if (e.target === overlay) {
        overlay.classList.add('hidden');
        overlay.classList.remove('flex');
        isOpen = false;
      }
    });
  }
</script>
