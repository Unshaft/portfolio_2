---
import ThemeToggle from './ThemeToggle.astro';

const url = new URL(Astro.request.url);
const pathname = url.pathname;

const currentLang = pathname.startsWith('/en') ? 'en' : 'fr';
const altLang = currentLang === 'en' ? 'fr' : 'en';

const navLinks = [
  { label: currentLang === 'en' ? 'Home' : 'Accueil', href: `/${currentLang}/` },
  { label: currentLang === 'en' ? 'Projects' : 'Projets', href: `/${currentLang}/projects` },
  { label: currentLang === 'en' ? 'About' : 'A propos', href: `/${currentLang}/about` },
  { label: 'CV', href: `/${currentLang}/cv` },
  { label: currentLang === 'en' ? 'Contact' : 'Contact', href: `/${currentLang}/contact` },
];

const { lang = currentLang, altLangHref } = Astro.props;
---

<nav class="w-full bg-white/80 dark:bg-midnight/80 backdrop-blur-xl border-b border-gray-200/50 dark:border-gray-700/30 px-4 sm:px-6 py-3 sm:py-4 transition-all duration-300 sticky top-0 z-50" aria-label={currentLang === 'fr' ? 'Navigation principale' : 'Main navigation'}>
  <div class="max-w-7xl mx-auto flex items-center justify-between">
    <!-- Logo -->
    <a href={`/${currentLang}/`} class="logo group text-lg sm:text-xl">
      <span class="gold-accent font-extrabold">K</span><span class="text-charcoal dark:text-white font-bold">illian</span><span class="text-gray-400 dark:text-gray-500 font-light">.dev</span>
    </a>

    <!-- Desktop menu -->
    <div class="hidden md:flex items-center space-x-1 lg:space-x-2">
      {navLinks.map(link => (
        <a href={link.href} class="nav-link text-sm lg:text-base px-3 py-2 rounded-lg hover:bg-gray-100/50 dark:hover:bg-gray-800/50">{link.label}</a>
      ))}

      <div class="w-px h-5 bg-gray-200 dark:bg-gray-700 mx-2"></div>

      <!-- Langue -->
      <a href={altLangHref ?? `/${altLang}${pathname.replace(/^\/(fr|en)/, '')}`} class="lang-switch px-3 py-2 rounded-lg hover:bg-gray-100/50 dark:hover:bg-gray-800/50" hreflang={altLang}>
        {altLang === 'en' ? 'EN' : 'FR'}
      </a>

      <!-- Dark Mode Toggle -->
      <ThemeToggle />
    </div>

    <!-- Burger (mobile only) -->
    <div class="md:hidden flex items-center gap-2">
      <ThemeToggle />
      <button
        id="burger-btn"
        class="flex items-center justify-center w-10 h-10 text-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-100/50 dark:hover:bg-gray-800/50 focus-visible:ring-2 focus-visible:ring-gold focus-visible:outline-none transition-colors cursor-pointer"
        aria-label="Menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <svg id="burger-icon" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2"
          viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
        <svg id="close-icon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" stroke-width="2"
          viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
          <path d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile menu -->
  <div id="mobile-menu" class="md:hidden hidden mt-4 pb-4 border-t border-gray-200/50 dark:border-gray-700/30 pt-4" role="navigation" aria-label={currentLang === 'fr' ? 'Menu mobile' : 'Mobile menu'}>
    <div class="flex flex-col space-y-1">
      {navLinks.map(link => (
        <a
          href={link.href}
          class="block px-4 py-3 text-base font-body font-medium text-gray-700 dark:text-gray-300 hover:text-gold dark:hover:text-gold hover:bg-gray-50/50 dark:hover:bg-gray-800/50 rounded-lg transition-all"
        >
          {link.label}
        </a>
      ))}
      <a
        href={altLangHref ?? `/${altLang}${pathname.replace(/^\/(fr|en)/, '')}`}
        class="block px-4 py-3 text-base font-body font-medium text-gray-500 dark:text-gray-400 hover:text-gold dark:hover:text-gold hover:bg-gray-50/50 dark:hover:bg-gray-800/50 rounded-lg transition-all"
      >
        {altLang === 'en' ? 'English' : 'Francais'}
      </a>
    </div>
  </div>
</nav>

<script is:inline>
  const burgerBtn = document.getElementById('burger-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const burgerIcon = document.getElementById('burger-icon');
  const closeIcon = document.getElementById('close-icon');

  burgerBtn?.addEventListener('click', () => {
    const isCurrentlyHidden = mobileMenu.classList.contains('hidden');
    mobileMenu.classList.toggle('hidden');
    burgerIcon.classList.toggle('hidden');
    closeIcon.classList.toggle('hidden');
    burgerBtn.setAttribute('aria-expanded', isCurrentlyHidden ? 'true' : 'false');
  });

  mobileMenu?.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      mobileMenu.classList.add('hidden');
      burgerIcon.classList.remove('hidden');
      closeIcon.classList.add('hidden');
      burgerBtn.setAttribute('aria-expanded', 'false');
    });
  });
</script>
